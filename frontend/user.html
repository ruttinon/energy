<!DOCTYPE html>
<html lang="th">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WEBVIEW-S | Energy Hub</title>
  <link
    href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;600;700&family=Rajdhani:wght@400;500;600&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="/frontend/user.css">

  <!-- Lightweight fallback functions: ensure goPage() and logout() exist immediately
     (prevents "goPage is not defined" if user.js hasn't loaded or has an error) -->
  <script>
    // Minimal safe fallbacks — will be overridden by /frontend/user.js if it defines them
    window.goPage = window.goPage || function (path) {
      try { window.location.href = path; } catch (e) { console.warn('goPage fallback failed', e); }
    };
    window.logout = window.logout || function () {
      if (confirm('คุณต้องการออกจากระบบหรือไม่?')) {
        try { sessionStorage.clear(); localStorage.clear(); } catch (e) {/*ignore*/ }
        window.location.href = "/frontend/login.html";
      }
    };
  </script>

</head>

<body>

  <!-- Background Effects -->
  <div class="cyber-grid"></div>
  <div class="glow-orb orb-1"></div>
  <div class="glow-orb orb-2"></div>
  <div class="particles" id="particles"></div>

  <!-- Header -->
  <header>
    <div class="header-left">
      <div class="logo">
        <svg viewBox="0 0 40 40" class="logo-icon" width="40" height="40" aria-hidden="true">
          <polygon points="20,2 38,11 38,29 20,38 2,29 2,11" fill="none" stroke="url(#grad1)" stroke-width="1.5" />
          <circle cx="20" cy="20" r="8" fill="none" stroke="url(#grad1)" stroke-width="1.5" />
          <circle cx="20" cy="20" r="3" fill="url(#grad1)" />
          <defs>
            <linearGradient id="grad1" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" style="stop-color:#00d4ff" />
              <stop offset="100%" style="stop-color:#00ffaa" />
            </linearGradient>
          </defs>
        </svg>
        <div class="logo-text">
          <span class="brand">WEBVIEW-S</span>
          <span class="tagline">ENERGY HUB</span>
        </div>
      </div>
    </div>

    <div class="header-right">
      <div class="pill" id="projName">–</div>
      <button class="logout-btn" onclick="logout()">
        <span>LOGOUT</span>
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18"
          aria-hidden="true">
          <path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4M16 17l5-5-5-5M21 12H9" />
        </svg>
      </button>
    </div>
  </header>

  <!-- Main Content -->
  <main>
    <!-- Left: Quick Menu -->
    <section class="card menu-card">
      <div class="card-header">
        <span class="card-icon">◈</span>
        <h2>MONITOR</h2>
      </div>
      <div class="menu-grid">
        <div class="menu-item" onclick="goPage('/frontend/monitor/index.html')">
          <div class="menu-icon" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <circle cx="12" cy="12" r="9" />
              <path d="M12 7v5l3 3" />
            </svg>
          </div>
          <span>Dashboard</span>
        </div>
        <div class="menu-item" onclick="goPage('/frontend/monitor/index.html')">
          <div class="menu-icon" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <path
                d="M12 9v4m0 4h.01M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z" />
            </svg>
          </div>
          <span>Alarms</span>
        </div>
        <div class="menu-item" onclick="goPage('/frontend/monitor/index.html')">
          <div class="menu-icon" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <rect x="3" y="3" width="18" height="14" rx="2" />
              <circle cx="8.5" cy="8.5" r="1.5" />
              <path d="M21 15l-5-5L5 21" />
            </svg>
          </div>
          <span>Photo</span>
        </div>
        <a class="menu-item" href="/frontend/monitor/index.html#trends" style="text-decoration:none; color:inherit;">
          <div class="menu-icon" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <path d="M3 3v18h18" />
              <path d="M7 14l4-4 4 5 5-7" />
            </svg>
          </div>
          <span>Trends</span>
        </a>
      </div>

      <div class="card-header" style="margin-top:20px;">
        <span class="card-icon">◈</span>
        <h2>ANALYSE</h2>
      </div>
      <div class="menu-grid single">
        <div class="menu-item wide" onclick="goPage('/frontend/monitor/index.html#energy')">
          <div class="menu-icon" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <rect x="3" y="10" width="4" height="10" />
              <rect x="10" y="6" width="4" height="14" />
              <rect x="17" y="2" width="4" height="18" />
            </svg>
          </div>
          <span>Consumption</span>
        </div>
      </div>
    </section>

    <!-- Right: Dashboard -->
    <section class="card dashboard-card">
      <div class="card-header">
        <span class="card-icon">◉</span>
        <h2>DASHBOARD</h2>
        <div class="tab-group">
          <button class="tab active" data-panel="status">Status</button>
          <button class="tab" data-panel="billing">Billing</button>
        </div>
      </div>

      <!-- Status Panel -->
      <div id="panel-status" class="panel">
        <div class="stats-row">
          <div class="stat-box">
            <div class="stat-value" id="sum-online">0</div>
            <div class="stat-label">ONLINE</div>
          </div>
          <div class="stat-box">
            <div class="stat-value offline" id="sum-offline">0</div>
            <div class="stat-label">OFFLINE</div>
          </div>
          <div class="stat-box">
            <div class="stat-value total" id="sum-total">0</div>
            <div class="stat-label">TOTAL</div>
          </div>
        </div>

        <div class="update-time">
          Last Update: <span id="updateTime">--:--:--</span>
        </div>

        <div class="table-wrap">
          <!-- HEADER TABLE -->
          <table class="table-header" aria-hidden="true">
            <thead>
              <tr>
                <th>CONVERTOR</th>
                <th>DEVICE</th>
                <th>IP ADDRESS</th>
                <th>LAST UPDATE</th>
                <th>STATUS</th>
              </tr>
            </thead>
          </table>

          <!-- BODY WRAPPER -->
          <div class="table-body">
            <table class="table-content" role="table" aria-label="System devices">
              <tbody id="system-table"></tbody>
            </table>
          </div>
        </div>

      </div>

      <!-- Billing Panel -->
      <div id="panel-billing" class="panel hidden">
        <div class="stats-row">
          <div class="stat-box">
            <div class="stat-value" id="bill-today">0.00</div>
            <div class="stat-label">TODAY (kWh)</div>
          </div>
          <div class="stat-box">
            <div class="stat-value" id="bill-month">0.00</div>
            <div class="stat-label">MONTH (kWh)</div>
          </div>
          <div class="stat-box">
            <div class="stat-value money" id="bill-money">0.00</div>
            <div class="stat-label">COST (THB)</div>
          </div>
        </div>

        <div class="chart-box">
          <canvas id="billingChart"></canvas>
          <div id="chart-message" style="display:none; text-align:center; padding:40px; color:#8b9eb5;">
            <svg viewBox="0 0 24 24" width="48" height="48" fill="none" stroke="currentColor" stroke-width="1.5"
              style="margin:0 auto 16px;">
              <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3m.08 4h.01M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0z" />
            </svg>
            <p style="font-size:16px; font-weight:600; margin-bottom:8px;">ไม่พบข้อมูลกราฟ</p>
            <p style="font-size:13px; opacity:0.7;">ระบบกำลังรวบรวมข้อมูล หรือยังไม่มีข้อมูลในช่วงเวลานี้</p>
          </div>
        </div>

        <!-- ✅ แก้ไข: รวมหัวตารางกับข้อมูลเป็นตารางเดียว -->
        <div class="table-wrap">
          <table class="table-header">
            <thead>
              <tr>
                <th>CONVERTOR</th>
                <th>DEVICES</th>
                <th>TODAY kWh</th>
                <th>TODAY ฿</th>
                <th>MONTH kWh</th>
                <th>MONTH ฿</th>
              </tr>
            </thead>
          </table>
          <div class="table-body">
            <table class="table-content">
              <tbody id="billing-table"></tbody>
            </table>
          </div>
        </div>
      </div>
    </section>
  </main>

  <footer>
    <div class="footer-line"></div>
    <span>© 2025 WEBVIEW-S • ENERGY MONITORING SYSTEM</span>
  </footer>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="/frontend/user.js?v=20251211" defer></script>

</body>

</html>
