<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Billing Admin | AE System</title>
  
  <!-- Font -->
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Custom CSS -->
  <link rel="stylesheet" href="billing_admin.css">
</head>
<body>

<div class="app-container">

  <!-- HEADER -->
  <header class="app-header">
    <div class="logo-section">
      <div class="logo-icon">‚ö°</div>
      <div class="logo-text">
        <h1>AE BILLING</h1>
        <p>Energy Management System</p>
      </div>
    </div>
    <div class="header-actions">
      <button class="btn btn-secondary" onclick="openTemplateManager()">
        üé® ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏ó‡∏°‡πÄ‡∏û‡∏•‡∏ï
      </button>
      <button class="btn btn-secondary" onclick="location.reload()">
        üîÑ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä
      </button>
    </div>
  </header>

  <!-- STATS GRID -->
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-label">‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</div>
      <div class="stat-value">
        <span id="sumTodayUnit">0.000</span>
        <span class="stat-unit">kWh</span>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-label">‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</div>
      <div class="stat-value">
        <span id="sumTodayMoney">0.00</span>
        <span class="stat-unit">‡∏ö‡∏≤‡∏ó</span>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-label">‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</div>
      <div class="stat-value">
        <span id="sumMonthUnit">0.000</span>
        <span class="stat-unit">kWh</span>
      </div>
    </div>
    <div class="stat-card highlight">
      <div class="stat-label">‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</div>
      <div class="stat-value">
        <span id="sumMonthMoney">0.00</span>
        <span class="stat-unit">‡∏ö‡∏≤‡∏ó</span>
      </div>
    </div>
  </div>

  <!-- MAIN GRID -->
  <div class="main-grid">
    
    <!-- CONTROL PANEL (SIDEBAR) -->
    <div class="control-panel">
      
      <!-- PRICE SECTION -->
      <div class="price-section">
        <h3>üí∞ ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü</h3>
        <div class="price-input-group">
          <input type="number" id="priceInput" placeholder="‡∏ö‡∏≤‡∏ó/‡∏´‡∏ô‡πà‡∏ß‡∏¢" step="0.01">
          <button class="btn btn-primary btn-icon" onclick="savePrice()" title="‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å">‚úì</button>
        </div>
      </div>

      <!-- EXPORT SECTION -->
      <div class="export-section">
        <h3>üìÑ ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å PDF</h3>
        <div class="export-buttons">

  <!-- GROUP 1: SUMMARY REPORT -->
  <h4 style="margin: 10px 0 6px; color: #bbb;">üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡πÑ‡∏ü</h4>

  <button class="export-btn" onclick="exportSummary('day')">
    <div class="icon">üìÖ</div>
    <div class="text">
      ‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô
      <span>‡∏™‡∏£‡∏∏‡∏õ‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</span>
    </div>
  </button>

  <button class="export-btn" onclick="exportSummary('month')">
    <div class="icon">üóìÔ∏è</div>
    <div class="text">
      ‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
      <span>‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</span>
    </div>
  </button>

  <button class="export-btn" onclick="exportSummary('year')">
    <div class="icon">üìÜ</div>
    <div class="text">
      ‡∏£‡∏≤‡∏¢‡∏õ‡∏µ
      <span>‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏õ‡∏µ</span>
    </div>
  </button>



  <!-- GROUP 2: MERGED REPORT -->
  <h4 style="margin: 20px 0 6px; color: #bbb;">üìö ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏£‡∏ß‡∏° (Summary + ‡∏ó‡∏∏‡∏Å‡∏ö‡∏¥‡∏•)</h4>

  <button class="export-btn primary" onclick="exportMerged('day')">
    <div class="icon">üìÑ</div>
    <div class="text">
      ‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô
      <span>‡∏£‡∏ß‡∏°‡∏™‡∏£‡∏∏‡∏õ + ‡∏ö‡∏¥‡∏•‡∏ó‡∏∏‡∏Å‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</span>
    </div>
  </button>

  <button class="export-btn primary" onclick="exportMerged('month')">
    <div class="icon">üìò</div>
    <div class="text">
      ‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
      <span>‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏∑‡∏≠‡∏ô + ‡∏ó‡∏∏‡∏Å‡∏ö‡∏¥‡∏•</span>
    </div>
  </button>

  <button class="export-btn primary" onclick="exportMerged('year')">
    <div class="icon">üìô</div>
    <div class="text">
      ‡∏£‡∏≤‡∏¢‡∏õ‡∏µ
      <span>‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏õ‡∏µ + ‡∏ó‡∏∏‡∏Å‡∏ö‡∏¥‡∏•</span>
    </div>
  </button>

</div>

      </div>

    </div>

    <!-- CHART SECTION -->
    <div class="chart-section">
      <div class="card-header">
        <div class="card-title">
          <div class="icon">üìà</div>
          ‡∏Å‡∏£‡∏≤‡∏ü‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô
        </div>
        <div class="chart-tabs">
          <button class="chart-tab active" data-range="day">‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</button>
          <button class="chart-tab" data-range="month">‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</button>
          <button class="chart-tab" data-range="year">‡∏£‡∏≤‡∏¢‡∏õ‡∏µ</button>
        </div>
      </div>
      <div class="chart-container">
        <canvas id="energyChart"></canvas>
      </div>
    </div>

  </div>

  <!-- TABS NAVIGATION -->
  <div class="tabs-section">
    <div class="tabs-nav">
      <button class="tab-btn active" data-tab="tabDevices">
        üí° ‡∏£‡∏≤‡∏¢‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á
        <span class="badge" id="deviceCount">0</span>
      </button>
      <button class="tab-btn" data-tab="tabConvertors">
        ‚öôÔ∏è ‡∏£‡∏≤‡∏¢‡∏Å‡∏•‡∏∏‡πà‡∏°
        <span class="badge" id="convertorCount">0</span>
      </button>
      <button class="tab-btn" data-tab="tabTotal">
        üì¶ ‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏ß‡∏°
      </button>
    </div>
  </div>

  <!-- TABLE: DEVICES -->
  <div id="tabDevices" class="tabContent">
    <div class="table-card fade-in">
      <div class="table-header">
        <div class="table-title">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
        <div class="table-actions">
          <button class="btn btn-secondary" onclick="loadDevicesTable()">üîÑ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä</button>
        </div>
      </div>
      <table>
        <thead>
          <tr>
            <th>‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</th>
            <th>‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤</th>
            <th>‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</th>
            <th>‡πÉ‡∏ä‡πâ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ (kWh)</th>
            <th>‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</th>
            <th>‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</th>
            <th>‡∏≠‡∏≠‡∏Å‡∏ö‡∏¥‡∏•</th>
          </tr>
        </thead>
        <tbody id="tbDevicesBody">
          <tr><td colspan="7" class="text-muted" style="text-align:center;padding:40px;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- TABLE: CONVERTORS -->
  <div id="tabConvertors" class="tabContent hidden">
    <div class="table-card fade-in">
      <div class="table-header">
        <div class="table-title">‡∏Å‡∏•‡∏∏‡πà‡∏° Convertor</div>
        <div class="table-actions">
          <button class="btn btn-secondary" onclick="loadConvertorTable()">üîÑ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä</button>
        </div>
      </div>
      <table>
        <thead>
          <tr>
            <th>Convertor</th>
            <th>‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÉ‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°</th>
            <th>‡πÉ‡∏ä‡πâ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ (kWh)</th>
            <th>‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</th>
            <th>‡πÉ‡∏ä‡πâ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ (kWh)</th>
            <th>‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</th>
            <th>‡∏≠‡∏≠‡∏Å‡∏ö‡∏¥‡∏•</th>
          </tr>
        </thead>
        <tbody id="tbConvertorsBody">
          <tr><td colspan="7" class="text-muted" style="text-align:center;padding:40px;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- TABLE: TOTAL -->
  <div id="tabTotal" class="tabContent hidden">
    <div class="table-card fade-in">
      <div class="table-header">
        <div class="table-title">‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏£‡∏∞‡∏ö‡∏ö</div>
      </div>
      <table>
        <thead>
          <tr>
            <th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
            <th>‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô (kWh)</th>
            <th>‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢ (‡∏ö‡∏≤‡∏ó)</th>
          </tr>
        </thead>
        <tbody id="tbTotalBody">
          <tr><td colspan="3" class="text-muted" style="text-align:center;padding:40px;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</td></tr>
        </tbody>
      </table>
    </div>
  </div>

</div>

<!-- TEMPLATE CHOOSER MODAL -->
<div id="templateModal" class="modal-overlay">
  <div class="modal">
    <div class="modal-header">
      <h2>üìÑ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ó‡∏°‡πÄ‡∏û‡∏•‡∏ï</h2>
      <button class="modal-close" onclick="closeTemplateModal()">√ó</button>
    </div>
    <div class="modal-body">
      <div id="templateList"></div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" onclick="closeTemplateModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
    </div>
  </div>
</div>

<!-- TEMPLATE MANAGER MODAL -->
<div id="templateManager" class="modal-overlay">
  <div class="modal" style="max-width:600px;">
    <div class="modal-header">
      <h2>üé® ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏ó‡∏°‡πÄ‡∏û‡∏•‡∏ï</h2>
      <button class="modal-close" onclick="closeTemplateManager()">√ó</button>
    </div>
    <div class="modal-body">
      <div id="templateManagerList"></div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-secondary" onclick="closeTemplateManager()">‡∏õ‡∏¥‡∏î</button>
      <button class="btn btn-primary" onclick="createNewTemplate()">‚ûï ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏ó‡∏°‡πÄ‡∏û‡∏•‡∏ï‡πÉ‡∏´‡∏°‡πà</button>
    </div>
  </div>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- Billing JS -->
<script src="billing_admin.js"></script>

</body>
</html>