<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>3D Office Floor Plan (Realistic Offline 360°)</title>
    <style>
      :root {
        --bg: #070d19;
        --panel: rgba(9, 15, 30, 0.86);
        --line: rgba(255, 255, 255, 0.18);
        --text: #eff4ff;
        --muted: #b4c6e2;
      }
      * { box-sizing: border-box; }
      html, body { margin: 0; height: 100%; }
      body {
        font-family: Inter, "Segoe UI", Tahoma, sans-serif;
        background: radial-gradient(circle at 20% 0%, #223b67, #0a1325 52%, #070d19);
        color: var(--text);
        overflow: hidden;
      }
      #view { width: 100vw; height: 100vh; display: block; }
      .panel {
        position: fixed; left: 14px; top: 14px; z-index: 3;
        width: min(390px, calc(100vw - 28px));
        background: var(--panel); border: 1px solid var(--line); border-radius: 12px;
        padding: 12px 14px; backdrop-filter: blur(8px);
      }
      h1 { margin: 0 0 6px; font-size: 1.05rem; }
      p, li { margin: 0; color: var(--muted); font-size: .88rem; line-height: 1.42; }
      ul { margin: 8px 0 0; padding-left: 20px; }
      .dot { width: 9px; height: 9px; border-radius: 50%; display: inline-block; margin-right: 6px; }
      .btns { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px; }
      button {
        border: 1px solid rgba(255,255,255,.24); background: rgba(135,206,250,.12); color: var(--text);
        border-radius: 999px; padding: 6px 10px; font-size: .8rem; cursor: pointer;
      }
      button:hover { border-color: #95d7ff; }
      .status {
        position: fixed; right: 14px; bottom: 14px; z-index: 3;
        background: var(--panel); border: 1px solid var(--line); border-radius: 10px;
        padding: 8px 10px; font-size: .78rem; color: var(--muted);
      }
    </style>
  </head>
  <body>
    <canvas id="view"></canvas>

    <div class="panel">
      <h1>Floor Plan 3D สไตล์ออฟฟิศ (สมจริง + หมุน 360°)</h1>
      <p>ลากเมาส์ซ้ายหมุน • ล้อเมาส์ซูม • Shift+ลากเพื่อเลื่อน • ปุ่มด้านล่างเรียกมุมกล้องพร้อมพรีเซนต์</p>
      <ul>
        <li><span class="dot" style="background:#7dd3fc"></span>Open Workspace (24 ที่นั่ง + เก้าอี้)</li>
        <li><span class="dot" style="background:#facc15"></span>Meeting Room (โต๊ะ + เก้าอี้ + หน้าจอ)</li>
        <li><span class="dot" style="background:#86efac"></span>Manager Room + ตู้เก็บเอกสาร</li>
        <li><span class="dot" style="background:#f9a8d4"></span>Lounge / Pantry (โซฟา + ต้นไม้)</li>
      </ul>
      <div class="btns">
        <button data-view="overview">Overview</button>
        <button data-view="top">Top</button>
        <button data-view="meeting">Meeting</button>
        <button data-view="workspace">Workspace</button>
        <button data-view="lounge">Lounge</button>
      </div>
    </div>

    <div class="status" id="status">18m x 12m • Office Environment</div>

    <script>
      const canvas = document.getElementById('view');
      const ctx = canvas.getContext('2d');
      const statusEl = document.getElementById('status');

      const camera = { yaw: -0.9, pitch: 0.62, zoom: 62, panX: 0, panY: 20 };
      const targetViews = {
        overview: { yaw: -0.9, pitch: 0.62, zoom: 62, panX: 0, panY: 20 },
        top: { yaw: 0.001, pitch: 1.3, zoom: 72, panX: 0, panY: 34 },
        meeting: { yaw: -2.35, pitch: 0.82, zoom: 82, panX: -55, panY: 14 },
        workspace: { yaw: -0.1, pitch: 0.72, zoom: 78, panX: 40, panY: 18 },
        lounge: { yaw: 2.7, pitch: 0.78, zoom: 84, panX: -40, panY: 22 }
      };

      function resize() {
        canvas.width = innerWidth * devicePixelRatio;
        canvas.height = innerHeight * devicePixelRatio;
        canvas.style.width = innerWidth + 'px';
        canvas.style.height = innerHeight + 'px';
        ctx.setTransform(devicePixelRatio, 0, 0, devicePixelRatio, 0, 0);
      }
      addEventListener('resize', resize);
      resize();

      function hexToRgb(hex) {
        const c = hex.replace('#', '');
        const n = parseInt(c, 16);
        return { r: (n >> 16) & 255, g: (n >> 8) & 255, b: n & 255 };
      }
      function rgbToCss(r,g,b){ return `rgb(${Math.round(r)},${Math.round(g)},${Math.round(b)})`; }
      function shade(hex, amt) {
        const {r,g,b} = hexToRgb(hex);
        return rgbToCss(Math.max(0,Math.min(255,r+amt)), Math.max(0,Math.min(255,g+amt)), Math.max(0,Math.min(255,b+amt)));
      }
      function lit(hex, normal) {
        const light = { x: -0.35, y: 0.86, z: 0.36 };
        const d = Math.max(0.15, normal.x*light.x + normal.y*light.y + normal.z*light.z);
        const amb = 0.35;
        const f = amb + d * 0.85;
        const {r,g,b} = hexToRgb(hex);
        return rgbToCss(r*f, g*f, b*f);
      }

      function project(x, y, z) {
        const cy = Math.cos(camera.yaw), sy = Math.sin(camera.yaw);
        let rx = x * cy - z * sy;
        let rz = x * sy + z * cy;

        const cp = Math.cos(camera.pitch), sp = Math.sin(camera.pitch);
        let ry = y * cp - rz * sp;
        rz = y * sp + rz * cp;

        return {
          x: innerWidth / 2 + rx * camera.zoom + camera.panX,
          y: innerHeight / 2 - ry * camera.zoom + camera.panY,
          depth: rz
        };
      }

      function boxFaces(b) {
        const { x, y, z, w, h, d, color, alpha = 1, glass = false } = b;
        const p = [
          [x-w/2,y,z-d/2],[x+w/2,y,z-d/2],[x+w/2,y,z+d/2],[x-w/2,y,z+d/2],
          [x-w/2,y+h,z-d/2],[x+w/2,y+h,z-d/2],[x+w/2,y+h,z+d/2],[x-w/2,y+h,z+d/2]
        ].map(v => project(v[0], v[1], v[2]));

        const defs = [
          { idx:[0,1,5,4], n:{x:0,y:0,z:-1} },
          { idx:[1,2,6,5], n:{x:1,y:0,z:0} },
          { idx:[2,3,7,6], n:{x:0,y:0,z:1} },
          { idx:[3,0,4,7], n:{x:-1,y:0,z:0} },
          { idx:[4,5,6,7], n:{x:0,y:1,z:0} }
        ];

        return defs.map(f => {
          const pts = f.idx.map(i => p[i]);
          const depth = pts.reduce((s, pt) => s + pt.depth, 0) / pts.length;
          return {
            pts,
            depth,
            fill: lit(color, f.n),
            a: glass ? 0.22 : alpha,
            stroke: glass ? 'rgba(180,220,255,.35)' : 'rgba(255,255,255,.1)'
          };
        });
      }

      const boxes = [];
      const lines = [];
      const labels = [];
      const circles = [];

      function addBox(x,y,z,w,h,d,color,alpha=1,glass=false){ boxes.push({x,y,z,w,h,d,color,alpha,glass}); }
      function addLabel(text,x,y,z){ labels.push({text,x,y,z}); }
      function addLine(x1,y1,z1,x2,y2,z2,c='rgba(170,205,255,.25)',lw=1){ lines.push({x1,y1,z1,x2,y2,z2,c,lw}); }
      function addCircle(x,y,z,r,color){ circles.push({x,y,z,r,color}); }

      // Room shell
      addBox(0,-0.25,0,18,0.4,12,'#2e374a'); // concrete slab
      addBox(0,3.2,0,18,0.08,12,'#f0f3f9'); // ceiling
      addBox(0,0,-6,18,3.2,0.2,'#d8e0ee');
      addBox(0,0,6,18,3.2,0.2,'#d8e0ee');
      addBox(-9,0,0,0.2,3.2,12,'#d8e0ee');
      addBox(9,0,0,0.2,3.2,12,'#d8e0ee');

      // Glass windows on front wall
      addBox(-3.4,0.85,-5.92,4.1,1.9,0.05,'#9ec6e8',1,true);
      addBox(3.4,0.85,-5.92,4.1,1.9,0.05,'#9ec6e8',1,true);

      // Partitions
      addBox(-2.8,0,2.4,0.18,3,7.2,'#e4ebf7');
      addBox(-5.9,0,-1.2,5.8,3,0.18,'#e4ebf7');
      addBox(5.9,0,-1.5,5.8,3,0.18,'#e4ebf7');

      // Zone plates
      addBox(2.8,0.02,2.1,8.8,0.05,7.8,'#7dd3fc',0.42);
      addBox(6.1,0.02,-3.8,5.8,0.05,3.8,'#facc15',0.48);
      addBox(-6.1,0.02,3.7,5.6,0.05,4.6,'#86efac',0.48);
      addBox(-6.1,0.02,-3.9,5.6,0.05,3.4,'#f9a8d4',0.48);

      // Flooring patterns (wood strips / tiles feeling)
      for (let z=-5.7; z<=5.7; z+=0.6) addLine(-8.8,0.001,z,8.8,0.001,z,'rgba(255,255,255,.06)');
      for (let x=-8.8; x<=8.8; x+=1.2) addLine(x,0.001,-5.8,x,0.001,5.8,'rgba(255,255,255,.04)');

      function addDesk(x,z,color='#5a6b82') {
        addBox(x,0.72,z,1.35,0.08,0.7,color);
        [[.6,.3],[.6,-.3],[-.6,.3],[-.6,-.3]].forEach(([ox,oz]) => addBox(x+ox,0,z+oz,0.08,0.72,0.08,'#1d2634'));
      }
      function addChair(x,z,color='#232f44') {
        addBox(x,0.46,z,0.44,0.06,0.44,color);
        addBox(x,0.58,z-0.18,0.44,0.48,0.06,color);
        addBox(x,0,z,0.05,0.44,0.05,'#111a28');
      }
      function addPlant(x,z) {
        addBox(x,0,z,0.35,0.28,0.35,'#8e6e42');
        addCircle(x,0.72,z,0.33,'#3aa65a');
        addCircle(x+0.13,0.95,z+0.08,0.24,'#3fbf63');
      }

      // Workspace desks + chairs
      for (let r=0;r<3;r++) {
        for (let c=0;c<4;c++) {
          const dx = 0.8 + c*2, dz = 0.8 + r*1.9;
          addDesk(dx,dz);
          addChair(dx, dz-0.65);
          addChair(dx, dz+0.65);
        }
      }

      // Meeting room setup
      addBox(6.1,0.74,-3.8,3.2,0.1,1.3,'#8c6c3f');
      for (let i=-1;i<=1;i++) {
        addChair(5.1 + i*1.0, -2.9, '#2f4058');
        addChair(5.1 + i*1.0, -4.7, '#2f4058');
      }
      addChair(4.1,-3.8,'#2f4058');
      addChair(8.1,-3.8,'#2f4058');
      addBox(8.72,1.15,-3.8,0.08,1.2,1.8,'#1f2c3f'); // TV wall screen
      addBox(8.65,1.22,-3.8,0.03,1.0,1.5,'#2d4e78');

      // Manager room and storage
      addDesk(-6.2,3.8,'#3f4d63');
      addChair(-6.2,3.1,'#2d3d56');
      addBox(-8.15,0,4.7,0.6,1.9,1.5,'#b8c6dc'); // cabinet
      addBox(-7.7,1.45,4.7,0.04,0.25,1.2,'#64758d');

      // Pantry / Lounge
      addBox(-6.1,0,-3.9,2.4,0.92,1,'#b980f0'); // island
      addBox(-4.8,0,-3.6,1.6,0.5,0.8,'#5e6b85'); // sofa base
      addBox(-4.8,0.5,-3.95,1.6,0.42,0.18,'#5e6b85'); // sofa back
      addBox(-4.8,0.52,-3.3,1.55,0.06,0.65,'#7a88a3'); // cushion
      addBox(-4.8,0,-2.5,0.8,0.46,0.8,'#8796b4'); // armchair
      addBox(-5.65,0.36,-2.95,0.6,0.06,0.6,'#a57f53'); // coffee table

      // Reception near entrance
      addBox(0.2,0,-4.9,2.6,1.02,0.8,'#4c5b73');
      addBox(0.2,0.82,-4.55,2.6,0.2,0.1,'#8392ab');
      addPlant(-1.6,-4.7);
      addPlant(1.9,-4.9);
      addPlant(-7.9,-3.1);
      addPlant(7.7,4.9);

      // Ceiling lights
      for (let x=-6;x<=6;x+=3) {
        for (let z=-4.5;z<=4.5;z+=3) {
          addBox(x,3.08,z,1.4,0.03,0.5,'#f8fcff');
          addLine(x-0.7,3.06,z,x+0.7,3.06,z,'rgba(255,255,210,.35)',2);
        }
      }

      // Labels
      addLabel('Open Workspace',2.8,1.95,2.2);
      addLabel('Meeting Room',6.1,1.95,-3.8);
      addLabel('Manager Room',-6.1,1.95,3.8);
      addLabel('Lounge / Pantry',-6.1,1.95,-3.9);
      addLabel('Reception',0.2,1.5,-4.9);

      function drawCircleBillboard(c) {
        const p = project(c.x,c.y,c.z);
        const s = c.r * camera.zoom;
        const g = ctx.createRadialGradient(p.x- s*0.2, p.y- s*0.2, s*0.2, p.x, p.y, s);
        g.addColorStop(0, shade(c.color, 35));
        g.addColorStop(1, shade(c.color, -20));
        ctx.fillStyle = g;
        ctx.beginPath();
        ctx.arc(p.x,p.y,s,0,Math.PI*2);
        ctx.fill();
      }

      function render() {
        const sky = ctx.createLinearGradient(0,0,0,innerHeight);
        sky.addColorStop(0,'#172745');
        sky.addColorStop(0.5,'#101b30');
        sky.addColorStop(1,'#090f1b');
        ctx.fillStyle = sky;
        ctx.fillRect(0,0,innerWidth,innerHeight);

        // subtle vignette
        const vg = ctx.createRadialGradient(innerWidth/2, innerHeight/2, innerWidth*0.25, innerWidth/2, innerHeight/2, innerWidth*0.75);
        vg.addColorStop(0,'rgba(0,0,0,0)'); vg.addColorStop(1,'rgba(0,0,0,.45)');

        // base grid
        lines.forEach(l => {
          const a = project(l.x1,l.y1,l.z1), b = project(l.x2,l.y2,l.z2);
          ctx.strokeStyle = l.c; ctx.lineWidth = l.lw || 1;
          ctx.beginPath(); ctx.moveTo(a.x,a.y); ctx.lineTo(b.x,b.y); ctx.stroke();
        });

        const faces = [];
        boxes.forEach(o => faces.push(...boxFaces(o)));
        faces.sort((a,b) => a.depth - b.depth);

        faces.forEach(f => {
          ctx.globalAlpha = f.a;
          ctx.fillStyle = f.fill;
          ctx.strokeStyle = f.stroke;
          ctx.beginPath();
          ctx.moveTo(f.pts[0].x, f.pts[0].y);
          for (let i=1;i<f.pts.length;i++) ctx.lineTo(f.pts[i].x, f.pts[i].y);
          ctx.closePath();
          ctx.fill();
          ctx.stroke();
        });

        circles
          .map(c => ({...c, d: project(c.x,c.y,c.z).depth}))
          .sort((a,b)=>a.d-b.d)
          .forEach(drawCircleBillboard);

        ctx.globalAlpha = 1;
        ctx.font = '600 14px Inter, sans-serif';
        ctx.textAlign = 'center';
        labels.forEach(l => {
          const p = project(l.x,l.y,l.z);
          const w = ctx.measureText(l.text).width + 16;
          ctx.fillStyle = 'rgba(0,0,0,.58)';
          ctx.fillRect(p.x - w/2, p.y - 14, w, 22);
          ctx.fillStyle = '#fff';
          ctx.fillText(l.text, p.x, p.y + 2);
        });

        ctx.fillStyle = vg;
        ctx.fillRect(0,0,innerWidth,innerHeight);
      }

      let drag = false, mode = 'rotate', lx = 0, ly = 0;
      canvas.addEventListener('mousedown', (e) => {
        drag = true;
        lx = e.clientX; ly = e.clientY;
        mode = e.shiftKey ? 'pan' : 'rotate';
      });
      addEventListener('mouseup', () => drag = false);
      addEventListener('mousemove', (e) => {
        if (!drag) return;
        const dx = e.clientX - lx, dy = e.clientY - ly;
        lx = e.clientX; ly = e.clientY;
        if (mode === 'pan') {
          camera.panX += dx;
          camera.panY += dy;
        } else {
          camera.yaw += dx * 0.008;
          camera.pitch += dy * 0.005;
          camera.pitch = Math.max(0.12, Math.min(1.36, camera.pitch));
        }
      });
      canvas.addEventListener('wheel', (e) => {
        e.preventDefault();
        camera.zoom -= Math.sign(e.deltaY) * 3.2;
        camera.zoom = Math.max(30, Math.min(150, camera.zoom));
      }, { passive: false });

      document.querySelectorAll('button[data-view]').forEach(btn => {
        btn.addEventListener('click', () => {
          const v = targetViews[btn.dataset.view];
          if (!v) return;
          Object.assign(camera, v);
        });
      });

      function tick() {
        render();
        statusEl.textContent = `Yaw ${camera.yaw.toFixed(2)} • Pitch ${camera.pitch.toFixed(2)} • Zoom ${camera.zoom.toFixed(0)} • Realistic Office Env (18m x 12m)`;
        requestAnimationFrame(tick);
      }
      tick();
    </script>
  </body>
</html>
